name: Flutter Lint Check
on:
  pull_request:
    branches:
      - "**"
jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source
        uses: actions/checkout@v4
      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: stable
          cache: true
      - name: Install dependencies
        run: flutter pub get
      - name: Generate code (json_serializable, retrofit, mockito)
        run: flutter pub run build_runner build --delete-conflicting-outputs
      - name: Generate localization files
        run: |
          flutter pub run easy_localization:generate -S assets/translations -O lib/core/localization
          flutter pub run easy_localization:generate -S assets/translations -O lib/core/localization -f keys -o locale_keys.g.dart
      # :white_check_mark: تحليل الكود باستخدام linter rules اللي في analysis_options.yaml
      - name: Run Flutter Analyze
        run: flutter analyze
      # :white_check_mark: Auto-fix formatting
      - name: Auto fix formatting
        run: dart format .
      # :white_check_mark: Check if formatting changed files
      - name: Check formatting changes
        id: format_check
        run: |
          if git diff --quiet; then
            echo "No formatting changes needed"
            echo "format_needed=false" >> $GITHUB_OUTPUT
          else
            echo "Formatting changes were applied"
            echo "format_needed=true" >> $GITHUB_OUTPUT
            echo "Changed files:"
            git diff --name-only
          fi